<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/UploadContract.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/UploadContract.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview
 * Formulario para subir un archivo PDF de contrato al backend.  
 * Gestiona todos los pasos desde la seleccion de fichero, validación básica y el envio por FormData
 * hasta la notificación al padre mediante onUpload cuando la subida es exitosa.
 */

import React, { useState } from 'react'
const API = import.meta.env.VITE_API_URL
import { Button } from '../components/ui/button'

/**
 * Componente de formulario de subida de contrato.
 * @param {object} props Props del componente.
 * @param {function(object): void} props.onUpload Callback que recibe la respuesta del servidor tras subir el PDF, tendra los datos del contrato parseado
 * @returns {JSX.Element} Formulario estilizado que permite seleccionar y subir un PDF.
 */

export default function UploadContract({ onUpload }) {
  //Como hemos ido haciendo en todos los componentes, usamos useState para manejar el estado del archivo seleccionado, errores y el estado de carga.
  const [file, setFile] = useState(null)
  const [error, setError] = useState('')
  const [loading, setLoading] = useState(false)

  /**
   * Esta función maneja el envío del formulario.
   * Los pasos que realiza son:
   * - Validar que se haya seleccionado un fichero.
   * - Envolvor el PDF en FormData y enviarlo al endpoint `/upload_contract`.
   * - En caso de que la subida fallara, muestra un error. Si tiene éxito, invoca onUpload().
   * @param {React.FormEvent&lt;HTMLFormElement>} e Evento de submit del formulario.
   */
  const handleSubmit = async e => {
    //funcioanlidad explicada anterioemente en boeform
    e.preventDefault()
    if (!file) {
      setError('Debes seleccionar un PDF')
      return
    }
    //Ponemos el estado de loading a true para indicar que estamos haciendo una petición al backend
    //y limpiamos errores anteriores si los hubiera
    setLoading(true)
    setError('')
    //Creamos un FormData para enviar el archivo PDF al backend
    //Esto es necesario porque el backend espera un FormData con el archivo bajo la clave 'file'
    const data = new FormData()
    data.append('file', file)
    try {
      //Realizamos la petición POST al backend para subir el contrato
      const res = await fetch(`${API}/upload_contract`, {
        method: 'POST',
        body: data,
      })
      if (!res.ok) throw new Error(`Error ${res.status}`)
      const body = await res.json()
      //Si la petición es exitosa, llamamos a onUpload con los datos del contrato parseado
      onUpload(body)
    } catch (err) {
      setError('Error subiendo contrato: ' + err.message)
    } finally {
      setLoading(false)
    }
  }

  return (
    &lt;form
      onSubmit={handleSubmit}
      className="space-y-4 w-full max-w-md mx-auto"
    >
      &lt;div className="w-full">
        &lt;label className="block font-medium mb-1 text-center">PDF del contrato&lt;/label>
        &lt;input
          type="file"
          accept="application/pdf"
          onChange={e => setFile(e.target.files[0])}
          className="w-full border rounded px-3 py-2"
        />
      &lt;/div>

      {error &amp;&amp; &lt;p className="text-red-600 text-center">{error}&lt;/p>}
      &lt;div className="text-center mt-4 w-100">
        &lt;Button
          type="submit"
          variant="primary"
          block
          disabled={!file}
        >
          {loading ? 'Subiendo…' : 'Subir contrato'}
        &lt;/Button>
      &lt;/div>
    &lt;/form>
  )
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#Button">Button</a></li><li><a href="global.html#Card">Card</a></li><li><a href="global.html#CardContent">CardContent</a></li><li><a href="global.html#CardHeader">CardHeader</a></li><li><a href="global.html#Progress">Progress</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Jul 06 2025 20:05:05 GMT+0200 (hora de verano de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
